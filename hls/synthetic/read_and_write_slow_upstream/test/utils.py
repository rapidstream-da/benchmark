"""Hacking utilities."""

import re
import logging

_logger = logging.getLogger(__name__)


# Generated by ChatGPT
def add_space_before_comments(file_paths: list[str]) -> None:
    """Replace string in a directory.

    Recursively replace occurrences of "//" with " //" where "//" has no space
    before it in all files in file_paths. HLS generates line in forms of
    "default_nettype wire//*". Iverilog recognizes wire and //* as a
    whole and throw an error. Thus the hack is used to prevent the error.
    """
    for file_path in file_paths:
        with open(file_path, 'r', encoding='utf-8') as file:
            file_contents = file.read()

        # replace "//" with " //" where "//" not after a space
        new_contents = re.sub(r'(?<! )//', ' //', file_contents,
                              flags=re.MULTILINE)

        if file_contents != new_contents:
            _logger.info("file %s has been modified to avoid "
                         "unrecognized comments", file_path)
            with open(file_path, 'w', encoding='utf-8') as file:
                file.write(new_contents)
